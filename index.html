<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de Baixas de Consumo</title>

    <link rel="stylesheet" href="style.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>

    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script> 
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

</head>
<body class="bg-gray-100 font-sans">

    <div id="loginContainer" class="auth-container" style="background: var(--darker); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; position: relative;">
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 180, 216, 0.1); backdrop-filter: blur(5px);"></div>
        <div class="main-login-grid" style="display: grid; grid-template-columns: 1fr 2fr; gap: 40px; max-width: 1400px; width: 90vw; z-index: 10;">
            <div class="auth-card" style="grid-column: span 1; background: white; padding: 50px 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);">
                <div class="auth-header" style="text-align: center;">
                    <img src="teste.png" class="w-40 h-auto mb-6 mx-auto object-contain" alt="Logo JP Tech">
                    <h2 style="color: var(--dark); font-size: 1.8rem; font-weight: 700;">Acesso ao Sistema</h2>
                    <p style="color: var(--secondary); font-size: 1rem; margin-bottom: 30px;">Controle de Baixas de Consumo</p>
                </div>
                <form id="loginForm" class="auth-form">
                    <div class="form-group" style="margin-bottom: 20px;">
    <label for="email" style="display: none;">E-mail:</label>
    <input type="email" id="email" placeholder="E-mail" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
</div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label for="password" style="display: none;">Senha:</label>
                        <input type="password" id="password" placeholder="Senha" required style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;">
                    </div>
                    <div class="form-group" id="filialSelectGroup" style="display: none; margin-bottom: 30px;">
                        <label for="filialSelect" class="block mb-1 font-semibold text-sm text-gray-700">Selecione a Filial:</label>
                        <select id="filialSelect" style="width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 8px;"></select>
                    </div>
                    <button type="submit" class="btn btn-primary w-full" style="background: var(--primary-gradient); color: white; padding: 14px; border-radius: 8px; font-weight: 700; font-size: 1rem;">ENTRAR</button>
                    <div class="mt-6 text-center text-sm">
                <a href="#" class="text-blue-600 hover:underline" onclick="openForgotPasswordModal()">Esqueceu sua senha?</a>
                <span class="mx-2 text-gray-400">|</span>
                <a href="#" class="text-blue-600 hover:underline" onclick="openRequestAccessModal()">Solicitar Acesso</a>
            </div>
                </form>
                <div id="loginAlert" class="mt-4" style="text-align: center;"></div>
                </div>

            <div style="grid-column: span 1; display: grid; grid-template-rows: 1fr 1fr; gap: 40px;">
                 <div style="background: var(--secondary-gradient); color: white; padding: 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 119, 182, 0.3); display: flex; flex-direction: column; justify-content: center;">
                    <div style="font-size: 1rem; opacity: 0.8; margin-bottom: 10px;">NOSSA MISSÃO</div>
                    <div style="font-size: 2.5rem; font-weight: 800; line-height: 1.2;">CONTROLE EFICIENTE, REDUÇÃO DE CUSTOS.</div>
                    <div style="font-size: 1.1rem; margin-top: 15px; font-weight: 400; opacity: 0.9;">Gerencie as baixas de consumo com precisão, agilidade e total rastreabilidade.</div>
                </div>
                 <div style="background: white; padding: 40px; border-radius: 16px; box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15); border-left: 5px solid var(--primary); display: flex; flex-direction: column; justify-content: center;">
                    <div style="color: var(--accent); font-weight: 700; margin-bottom: 10px;">FLUXO SIMPLIFICADO</div>
                    <h3 style="font-size: 1.2rem; font-weight: 700; color: var(--dark); margin-bottom: 15px;">GESTÃO DE BAIXAS EM ETAPAS</h3>
                    <ul style="list-style-type: none; margin: 0; padding: 0; font-size: 0.95rem; color: #555;">
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">1. Solicitação:</span> Operação registra a necessidade.</li>
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">2. Aprovação:</span> Gestor autoriza ou nega.</li>
                        <li style="margin-bottom: 5px;"><span style="color: var(--primary); font-weight: 600;">3. Execução:</span> Prevenção realiza a baixa e anexa comprovantes.</li>
                        <li><span style="color: var(--primary); font-weight: 600;">4. Retirada:</span> Operação confirma o recebimento e anexa foto.</li>
                    </ul>
                </div>
            </div>
        </div>
        <div style="position: absolute; bottom: 20px; color: rgba(255, 255, 255, 0.8); font-size: 0.9rem; text-align: center; width: 100%; z-index: 10;">
            © 2025 - Controle de Baixas | Desenvolvido por <span style="font-weight: 700;">@ JP Tech Solutions</span>
        </div>
    </div>


    <div id="mainSystem" class="flex h-screen" style="display: none;">
        <aside class="sidebar">
            <div class="p-6 border-b border-gray-700">
                <div class="flex items-center">
                    <i data-feather="clipboard" class="h-8 w-8 text-blue-400 mr-3"></i>
                    <h1 class="text-xl font-bold text-white">Controle de Baixas</h1>
                </div>
                <p class="text-sm text-gray-300 mt-2">Usuário: <span class="font-medium" id="sidebarUser">N/A</span></p>
                <p class="text-sm text-gray-300 mt-1">Filial: <span class="font-medium" id="sidebarFilial">N/A</span></p>
            </div>
            <nav class="p-4">
                <a href="#novaSolicitacao" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('novaSolicitacaoView', this)" data-role="operacao">
                    <i data-feather="plus-circle" class="h-5 w-5 mr-3"></i>
                    <span>Nova Solicitação</span>
                </a>
                 <a href="#minhasSolicitacoes" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('minhasSolicitacoesView', this)" data-role="operacao">
                    <i data-feather="list" class="h-5 w-5 mr-3"></i>
                    <span>Minhas Solicitações</span>
                </a>
                 <a href="#aprovarSolicitacoes" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('aprovarSolicitacoesView', this)" data-role="gestor">
                    <i data-feather="check-square" class="h-5 w-5 mr-3"></i>
                    <span>Aprovar Baixas</span>
                </a>
                 <a href="#executarSolicitacoes" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('executarSolicitacoesView', this)" data-role="prevencao">
                    <i data-feather="tool" class="h-5 w-5 mr-3"></i>
                    <span>Executar Baixas</span>
                </a>
                 <a href="#historicoBaixas" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('historicoBaixasView', this)" data-role="gestor,prevencao,admin"> <i data-feather="archive" class="h-5 w-5 mr-3"></i>
                    <span>Histórico Geral</span>
                </a>
                
                <a href="#graficos" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('graficosView', this)" data-role="gestor,admin">
                    <i data-feather="trending-up" class="h-5 w-5 mr-3"></i>
                    <span>Gráficos & Análises</span>
                </a>
                
                <div class="mt-4 border-t border-gray-700 pt-2">
                    <span class="p-3 text-xs font-semibold text-gray-500 uppercase">Administração</span>
                </div>
                
                <a href="#gerenciarUsuarios" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarUsuariosView', this)" data-role="admin">
                    <i data-feather="users" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar Usuários</span>
                </a>
                <a href="#gerenciarFiliais" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarFiliaisView', this)" data-role="admin">
                    <i data-feather="briefcase" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar Filiais</span>
                </a>
                <a href="#gerenciarProdutos" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarProdutosView', this)" data-role="admin">
                    <i data-feather="package" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar Produtos</span>
                </a>
                <a href="#gerenciarCgo" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarCgoView', this)" data-role="admin">
                    <i data-feather="settings" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar CGOs</span>
                </a>
                
                <a href="#gerenciarTiposBaixa" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarTiposBaixaView', this)" data-role="admin">
                    <i data-feather="tag" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar Tipos de Baixa</span>
                </a>
                
                <a href="#gerenciarLinhas" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarLinhasView', this)" data-role="admin">
                    <i data-feather="align-left" class="h-5 w-5 mr-3"></i>
                    <span>Linhas Orçamentárias</span>
                </a>
               <a href="#gerenciarOrcamentos" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('gerenciarOrcamentosView', this)" data-role="admin">
                    <i data-feather="dollar-sign" class="h-5 w-5 mr-3"></i>
                    <span>Gerenciar Orçamentos</span>
                </a>
                
                <a href="#lancamentoManualRealizado" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('lancamentoManualRealizadoView', this)" data-role="admin">
                    <i data-feather="edit-3" class="h-5 w-5 mr-3"></i>
                    <span>Lançar Realizado Manual</span>
                </a>

                <a href="#lancamentosFinanceiros" class="nav-item p-3 rounded-lg mb-2 flex items-center cursor-pointer" onclick="showView('lancamentosFinanceirosView', this)" data-role="gestor,admin">
                    <i data-feather="file-text" class="h-5 w-5 mr-3"></i>
                    <span>Lançar Despesa (NF)</span>
                </a>

                <div id="logoutLink" class="p-3 rounded-lg mt-auto flex items-center text-red-400 cursor-pointer hover:bg-gray-700" onclick="logout()">
<i data-feather="log-out" class="h-5 w-5 mr-3"></i>
<span>Sair</span>
</div>
            </nav>
        </aside>

        <main class="flex-1 overflow-auto bg-gray-100 main-content">
            <div class="container mx-auto px-6 py-8">

                <div id="homeView" class="view-content active">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Bem-vindo(a)!</h1>
                    <p class="text-gray-600">Selecione uma opção no menu lateral para começar.</p>
                </div>

                <div id="novaSolicitacaoView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Nova Solicitação de Baixa</h1>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-xl font-semibold mb-4">Passo 1: Intenção da Baixa</h3>
                        <div class="form-group">
                            <label for="tipoBaixaSelect" class="font-semibold">Selecione o Tipo de Baixa:</label>
                            <select id="tipoBaixaSelect" class="w-full">
                                <option value="">Carregando tipos de baixa...</option>
                            </select>
                            <small class="text-gray-500">Isso definirá os produtos e CGOs permitidos para esta solicitação.</small>
                        </div>
                        <div id="tipoBaixaAlert" class="mt-4"></div>
                    </div>

                    <div id="solicitacaoPasso2" style="display: none;">
                        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                            <h3 class="text-xl font-semibold mb-4">Passo 2: Adicionar Itens</h3>
                            <form id="addItemForm" class="form-grid" style="grid-template-columns: 1fr 1fr; align-items: flex-end;">
                                <div class="form-group" style="grid-column: 1 / 2;">
                                    <label for="produtoCodigo">Código do Produto:</label>
                                    <input type="text" id="produtoCodigo" required class="w-full">
                                </div>
                                <div class="form-group" style="grid-column: 2 / 3;">
                                    <label>Descrição:</label>
                                    <input type="text" id="produtoDescricao" readonly disabled class="w-full bg-gray-200">
                                    <input type="hidden" id="produtoId">
                                </div>
                                <div class="form-group" style="grid-column: 1 / 2;">
                                    <label for="quantidadeSolicitada">Quantidade:</label>
                                    <input type="number" id="quantidadeSolicitada" min="1" required class="w-full">
                                </div>
                                <div class="form-group" style="grid-column: 2 / 3;">
                                    <label for="valorUnitarioSolicitado">Valor Unitário (R$):</label>
                                    <input type="number" id="valorUnitarioSolicitado" step="0.01" min="0" required class="w-full">
                                </div>
                                 <div class="form-group" style="grid-column: 1 / 2;">
                                    <label>Valor Total do Item (R$):</label>
                                    <input type="text" id="valorTotalSolicitado" readonly disabled class="w-full bg-gray-200">
                                </div>
                                <div class="form-group" style="grid-column: 2 / 3; text-align: left;">
                                    <button type="submit" class="btn btn-primary w-full">
                                        <i data-feather="plus" class="h-4 w-4 inline-block -mt-1"></i> 
                                        Adicionar Item ao Pedido
                                    </button>
                                </div>
                            </form>
                            <div id="addItemAlert" class="mt-4"></div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Passo 3: Itens do Pedido</h3>
                            <div class="table-container">
                                <table class="w-full">
                                    <thead>
                                        <tr>
                                            <th>Produto</th>
                                            <th>Qtd.</th>
                                            <th>Valor Unit.</th>
                                            <th>Valor Total</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="carrinhoItensBody">
                                        <tr>
                                            <td colspan="5" class="text-center py-4 text-gray-500">Nenhum item adicionado.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-6 text-right">
                                <h3 class="text-2xl font-bold">Valor Total do Pedido: R$ <span id="carrinhoValorTotal">0.00</span></h3>
                                <button id="submitPedidoButton" class="btn btn-success w-full md:w-auto mt-4" disabled>
                                    <i data-feather="send" class="h-4 w-4 inline-block -mt-1"></i>
                                    Enviar Solicitação
                                </button>
                            </div>
                            <div id="novaSolicitacaoAlert" class="mt-4"></div>
                        </div>
                    </div>
                </div>
                
                <div id="minhasSolicitacoesView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Minhas Solicitações</h1>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data</th>
                                    <th>Produto(s)</th>
                                    <th>Qtd. Sol.</th>
                                    <th>Valor Sol. (R$)</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="minhasSolicitacoesBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="aprovarSolicitacoesView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Aprovar Solicitações Pendentes</h1>
                    <div class="table-container bg-white rounded-lg shadow-md">
                         <table class="w-full">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data</th>
                                    <th>Solicitante</th>
                                    <th>Produto(s)</th>
                                    <th>Qtd.</th>
                                    <th>Valor (R$)</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="aprovarSolicitacoesBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="executarSolicitacoesView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Executar Baixas Aprovadas</h1>
                    <div class="table-container bg-white rounded-lg shadow-md">
                         <table class="w-full">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data Sol.</th>
                                    <th>Solicitante</th>
                                    <th>Produto(s)</th>
                                    <th>Qtd. Sol.</th>
                                    <th>Valor Sol. (R$)</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="executarSolicitacoesBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="historicoBaixasView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Histórico Geral de Baixas</h1>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                             <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data</th>
                                    <th>Filial</th>
                                    <th>Solicitante</th>
                                    <th>Produto(s)</th>
                                    <th>Qtd. Exec.</th>
                                    <th>Valor Exec. (R$)</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="historicoBaixasBody">
                                </tbody>
                        </table>
                    </div>
                </div>

                <div id="graficosView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Análises e Indicadores</h1>
                    <div id="graficosContainer" class="space-y-8">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Filtros</h3>
                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <div class="form-group">
                                    <label for="graficoFilialSelect" class="font-semibold">Filial:</label>
                                    <select id="graficoFilialSelect" class="w-full"></select>
                                </div>
                                <div class="form-group">
                                    <label for="graficoAnoSelect" class="font-semibold">Ano:</label>
                                    <select id="graficoAnoSelect" class="w-full"></select>
                                </div>
                                <div class="form-group pt-6">
                                    <button id="gerarGraficosBtn" class="btn btn-primary w-full">Gerar Gráficos</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Orçado vs Realizado (Linhas Orçamentárias)</h3>
                                <p class="text-sm text-gray-500 mb-2">Comparativo Orçado vs Realizado por Linha (Mês a Mês). Use o Desvio % para Savings.</p>
                                <div class="relative h-96">
                                    <canvas id="orcamentoRealizadoLinhasChart"></canvas>
                                </div>
                                <div id="desvioOrcamentarioLinhas" class="mt-4"></div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Orçado vs Realizado (CGOs Mais Usados)</h3>
                                <p class="text-sm text-gray-500 mb-2">Comparativo Orçado vs Realizado por CGO (Mês Atual).</p>
                                <div class="relative h-96">
                                    <canvas id="orcamentoRealizadoCGOsChart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h3 class="text-xl font-semibold mb-4">Top 10 Itens que Mais Impactam o Custo</h3>
                            <p class="text-sm text-gray-500 mb-2">Itens classificados por Valor e Quantidade total de baixas.</p>
                            <div class="relative h-96">
                                <canvas id="topItensImpactoChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Projeção de Gastos (Mês Atual)</h3>
                                <p class="text-sm text-gray-500 mb-2">Valor Realizado até hoje vs Projeção de Fechamento (Linhas).</p>
                                <div class="relative h-96">
                                    <canvas id="projecaoGastosMensalChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <h3 class="text-xl font-semibold mb-4">Comparativo Anual (Realizado)</h3>
                                <p class="text-sm text-gray-500 mb-2">Visualização do Realizado nos últimos anos (Crescimento/Redução).</p>
                                <div class="relative h-96">
                                    <canvas id="comparativoAnualChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="lancamentoManualRealizadoView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Lançamento Manual Realizado (Histórico)</h1>
                    <p class="text-gray-600 mb-6">Permite o registro de valores realizados para anos/meses anteriores onde o sistema não estava em uso. Estes valores serão usados nos gráficos comparativos.</p>

                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <h3 class="text-xl font-semibold mb-4">Filtros e Edição</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="form-group">
                                <label for="manualFilialSelect" class="font-semibold">Filial:</label>
                                <select id="manualFilialSelect" class="w-full"></select>
                            </div>
                            <div class="form-group">
                                <label for="manualAnoSelect" class="font-semibold">Ano:</label>
                                <select id="manualAnoSelect" class="w-full"></select>
                            </div>
                            <div class="form-group">
                                <label for="manualLinhaSelect" class="font-semibold">Linha Orçamentária:</label>
                                <select id="manualLinhaSelect" class="w-full"></select>
                            </div>
                            <div class="form-group pt-6">
                                <button id="buscarRealizadoManualBtn" class="btn btn-primary w-full">Buscar Valores</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="lancamentoManualFormContainer" style="display: none;" class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-4">Valores Realizados por Mês (R$)</h3>
                        <form id="lancamentoManualForm">
                            <input type="hidden" id="manualFormLinhaId">
                            <input type="hidden" id="manualFormFilialId">
                            <input type="hidden" id="manualFormAno">
                            
                            <div id="realizadoManualInputsGrid" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                </div>
                            
                            <div id="lancamentoManualAlert" class="mt-4"></div>
                            <button type="submit" class="btn btn-success w-full md:w-auto">Salvar Realizado Manual</button>
                        </form>
                    </div>
                </div>

                <div id="gerenciarUsuariosView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Usuários</h1>
                        <button class="btn btn-success" onclick="abrirUsuarioModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Novo Usuário
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome</th>
                                    <th>Usuário (login)</th>
                                    <th>E-mail</th> <th>Grupo (Role)</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="usuariosTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="gerenciarFiliaisView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Filiais</h1>
                        <button class="btn btn-success" onclick="abrirFilialModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Nova Filial
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nome (Ex: 464)</th>
                                    <th>Descrição (Ex: MT - Cuiabá)</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="filiaisTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="gerenciarProdutosView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Produtos</h1>
                        <button class="btn btn-success" onclick="abrirProdutoModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Novo Produto
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Cód.</th>
                                    <th>Descrição</th>
                                    <th>CGOs Permitidos</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="produtosTableBody">
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="gerenciarCgoView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar CGOs</h1>
                        <button class="btn btn-success" onclick="abrirCgoModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Novo CGO
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Cód. CGO</th>
                                    <th>Descrição</th>
                                    <th>Observação</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="cgoTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="gerenciarTiposBaixaView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Gerenciar Tipos de Baixa</h1>
                        <button class="btn btn-success" onclick="abrirTipoBaixaModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Novo Tipo de Baixa
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Nome (Ex: QUEBRA)</th>
                                    <th>Descrição</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="tiposBaixaTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                
                <div id="gerenciarLinhasView" class="view-content">
                    <div class="flex justify-between items-center mb-6">
                        <h1 class="text-3xl font-bold text-gray-800">Linhas Orçamentárias</h1>
                        <button class="btn btn-success" onclick="abrirLinhaModal(null)">
                            <i data-feather="plus" class="h-4 w-4 inline-block -mt-1 mr-1"></i>
                            Nova Linha
                        </button>
                    </div>
                    <div class="table-container bg-white rounded-lg shadow-md">
                        <table class="w-full">
                            <thead>
                                <tr>
                                    <th>Código</th>
                                    <th>Descrição</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="linhasTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div id="gerenciarOrcamentosView" class="view-content">
                    <h1 class="text-3xl font-bold text-gray-800 mb-6">Gerenciar Orçamentos</h1>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-group">
                                <label for="orcamentoFilialSelect" class="font-semibold">Filial:</label>
                                <select id="orcamentoFilialSelect" class="w-full">
                                    <option value="">Carregando filiais...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="orcamentoAnoSelect" class="font-semibold">Ano:</label>
                                <select id="orcamentoAnoSelect" class="w-full">
                                    </select>
                            </div>
                            <div class="form-group pt-6">
                                <button id="buscarOrcamentosBtn" class="btn btn-primary w-full">Buscar Orçamentos</button>
                            </div>
                        </div>
                        <div id="orcamentosAlert" class="mt-4"></div>
                    </div>
                    
                    <div class="table-container bg-white rounded-lg shadow-md" style="overflow-x: auto;">
                        <table class="w-full" id="orcamentosTable">
                            <thead>
                                <tr>
                                    <th>Linha Orçamentária</th>
                                    <th>Jan</th>
                                    <th>Fev</th>
                                    <th>Mar</th>
                                    <th>Abr</th>
                                    <th>Mai</th>
                                    <th>Jun</th>
                                    <th>Jul</th>
                                    <th>Ago</th>
                                    <th>Set</th>
                                    <th>Out</th>
                                    <th>Nov</th>
                                    <th>Dez</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="orcamentosTableBody">
                                <tr>
                                    <td colspan="14" class="text-center py-4 text-gray-500">Selecione uma filial e um ano para começar.</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="lancamentosFinanceirosView" class="view-content">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">Lançar Despesa Externa (NF)</h1>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h3 class="text-xl font-semibold mb-4">Passo 1: Dados da Nota Fiscal</h3>
        <form id="lancamentoNfForm" class="form-grid" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="form-group">
                <label for="nfNumero">Número da NF:</label>
                <input type="text" id="nfNumero" required class="w-full">
            </div>
            <div class="form-group">
                <label for="nfData">Data da NF:</label>
                <input type="date" id="nfData" required class="w-full">
            </div>
            <div class="form-group">
                <label for="nfAnexo">Anexo da NF (PDF/Imagem):</label>
                <input type="file" id="nfAnexo" required class="w-full text-sm" accept="image/*,application/pdf">
            </div>
        </form>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h3 class="text-xl font-semibold mb-4">Passo 2: Itens da Nota</h3>
        <form id="addItemNfForm" class="form-grid" style="grid-template-columns: 2fr 1fr 1fr; align-items: flex-end;">
            <div class="form-group">
                <label for="nfItemDescricao">Descrição do Item/Serviço:</label>
                <input type="text" id="nfItemDescricao" required class="w-full">
            </div>
            <div class="form-group">
                <label for="nfItemQtd">Quantidade:</label>
                <input type="number" id="nfItemQtd" min="0.01" step="0.01" required class="w-full" value="1">
            </div>
            <div class="form-group">
                <label for="nfItemValorUnit">Valor Unitário (R$):</label>
                <input type="number" id="nfItemValorUnit" step="0.01" min="0" required class="w-full">
            </div>
            <div class="form-group" style="grid-column: 3 / 4; text-align: left;">
                <button type="submit" class="btn btn-primary w-full">
                    <i data-feather="plus" class="h-4 w-4 inline-block -mt-1"></i> Adicionar Item
                </button>
            </div>
        </form>
        <div id="addItemNfAlert" class="mt-4"></div>

        <div class="table-container mt-4">
            <table class="w-full">
                <thead>
                    <tr>
                        <th>Descrição</th>
                        <th>Qtd.</th>
                        <th>Valor Unit.</th>
                        <th>Valor Total</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="carrinhoNfItensBody">
                    <tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhum item adicionado.</td></tr>
                </tbody>
            </table>
        </div>
        <div class="mt-6 text-right">
            <h3 class="text-2xl font-bold">Valor Total da NF: R$ <span id="carrinhoNfValorTotal">0.00</span></h3>
        </div>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md mb-6">
        <h3 class="text-xl font-semibold mb-4">Passo 3: Impacto Orçamentário</h3>
        <div class="form-group mb-4">
            <label for="nfLinhaOrcamentariaSelect" class="font-semibold">Selecione a Linha Orçamentária para debitar:</label>
            <select id="nfLinhaOrcamentariaSelect" class="w-full">
                <option value="">Carregando linhas...</option>
            </select>
        </div>
        
        <div id="nfSimulacaoOrcamento" class="p-4 bg-blue-50 border border-blue-200 rounded-lg" style="display: none;">
            </div>

        <div id="lancamentoNfAlert" class="mt-4"></div>
        <button id="submitLancamentoNfButton" class="btn btn-success w-full mt-6" disabled>
            <i data-feather="save" class="h-4 w-4 inline-block -mt-1"></i>
            Salvar Lançamento de Despesa
        </button>
    </div>

    <div class="bg-white p-6 rounded-lg shadow-md">
        <h3 class="text-xl font-semibold mb-4">Histórico de Despesas Externas (NF)</h3>
        <div class="table-container">
            <table class="w-full">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Data Lanç.</th>
                        <th>Data NF</th>
                        <th>Nº NF</th>
                        <th>Linha Orçamentária</th>
                        <th>Valor Total</th>
                        <th>Anexo</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="lancamentosNfTableBody">
                    <tr><td colspan="8" class="loading"><div class="spinner"></div>Carregando...</td></tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
                


            </div>
        </main>
    </div>

    <div id="detalhesModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px;">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-semibold">Detalhes da Solicitação #<span id="detalhesId"></span></h3>
                 <button class="btn btn-danger btn-small" onclick="closeModal('detalhesModal')">Fechar</button>
            </div>
            
            <div id="detalhesOrcamentoSection" class="p-4 mb-4 bg-blue-50 border border-blue-200 rounded-lg" style="display: none;">
                <div class="loading"><div class="spinner"></div>Simulando orçamento...</div>
            </div>
            <div id="detalhesContent" class="space-y-3 text-sm">
                </div>
        </div>
    </div>
    <div id="executarModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <h3 class="text-xl font-semibold mb-4">Executar Baixa - Solicitação #<span id="executarId"></span></h3>
            
            <form id="executarForm" class="flex-1 flex flex-col min-h-0">
                <input type="hidden" id="executarSolicitacaoId">
                <input type="hidden" id="executarTipoBaixaId"> 

                <p class="mb-3 text-gray-700">
                    <strong>Intenção de Baixa (Tipo):</strong> 
                    <span id="executarIntencaoBaixa" class="font-semibold text-blue-700">Carregando...</span>
                </p>

                <div class="form-group mb-4 flex-1 overflow-y-auto">
                    <label class="block mb-2 font-semibold">Itens Aprovados para Execução:</label>
                    <div id="executarItensList" class="space-y-3 pr-2">
                        <div class="loading"><div class="spinner"></div>Carregando itens...</div>
                    </div>
                </div>

                <div class="border-t pt-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div class="form-group">
                             <label for="codigoMovimentacao">CGO (Cód. Movimentação):</label>
                             <select id="codigoMovimentacao" required class="w-full" disabled>
                                 <option value="">Selecione os itens primeiro...</option>
                             </select>
                             <small id="cgoHelp" class="text-gray-500">A lista mostra CGOs comuns a *todos* os itens selecionados.</small>
                        </div>
                         <div class="form-group">
                            <label for="justificativaExecucao">Justificativa (para todos itens selecionados):</label>
                            <input type="text" id="justificativaExecucao" required class="w-full">
                        </div>
                    </div>
                    <div class="form-group mb-4">
                         <label for="anexosExecucao">Anexos (Opcional):</label>
                         <input type="file" id="anexosExecucao" multiple class="w-full text-sm">
                         <small class="text-gray-500">Anexos para *esta* execução (serão ligados aos itens selecionados).</small>
                     </div>
                </div>
                
                <div id="executarAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Confirmar Execução dos Itens Selecionados</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('executarModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="retiradaModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; display: flex; flex-direction: column;">
            <h3 class="text-xl font-semibold mb-4">Confirmar Retirada - Pedido #<span id="retiradaPedidoIdDisplay"></span></h3>
            
            <form id="retiradaForm" class="flex-1 flex flex-col min-h-0">
                <input type="hidden" id="retiradaSolicitacaoId"> <div class="form-group mb-4 flex-1 overflow-y-auto">
                    <label class="block mb-2 font-semibold">Itens Aguardando Retirada:</label>
                    <div id="retiradaItensList" class="space-y-3 pr-2">
                        <div class="loading"><div class="spinner"></div>Carregando itens...</div>
                    </div>
                </div>

                <div class="border-t pt-4">
                    <div class="form-group mb-4">
                         <label for="fotosRetirada">Anexos de Retirada (Múltiplos):</label>
                         <input type="file" id="fotosRetirada" accept="image/*,application/pdf" required multiple class="w-full text-sm">
                         <small class="text-gray-500">Anexe uma ou mais fotos/anexos da retirada. Eles serão aplicados a TODOS os itens selecionados.</small>
                     </div>
                </div>
                
                <div id="retiradaAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Confirmar Retirada dos Itens Selecionados</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('retiradaModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="usuarioModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
           <h3 class="text-xl font-semibold mb-4" id="usuarioModalTitle">Editar Perfil de Usuário</h3>
            <form id="usuarioForm">
                <input type="hidden" id="usuarioId">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-group">
                        <label for="usuarioNome">Nome Completo:</label>
                        <input type="text" id="usuarioNome" required class="w-full">
                    </div>
                    <div class="form-group">
                       <label for="usuarioUsername">Usuário (login - Não editável aqui):</label> <input type="text" id="usuarioUsername" required class="w-full bg-gray-200" disabled> ```
                    </div>
                </div>
                <div class="form-group mb-4">
                   <label for="usuarioEmail">E-mail (do Perfil - Login não alterado aqui):</label> <input type="email" id="usuarioEmail" required class="w-full">
                </div>
             <div class="alert alert-info mb-4 text-sm">
                <strong>Gerenciamento de Login e Senha:</strong> A criação de novos usuários e a alteração de senhas devem ser feitas pelo painel de Autenticação do Supabase (que envia convites/links de recuperação por e-mail). Esta tela gerencia apenas o perfil (Nome, Grupo, Filiais, Status).
            </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="form-group">
                        <label for="usuarioRole">Grupo (Role):</label>
                        <select id="usuarioRole" required class="w-full">
                            <option value="" disabled>Selecione...</option>
                            <option value="admin">Admin</option>
                            <option value="gestor">Gestor</option>
                            <option value="prevencao">Prevenção</option>
                            <option value="operacao">Operação</option>
                        </select>
                    </div>
                    <div class="form-group flex items-center pt-6">
                        <input type="checkbox" id="usuarioAtivo" class="h-5 w-5" checked>
                        <label for="usuarioAtivo" class="ml-2 font-normal">Usuário Ativo</label>
                    </div>
                </div>
                <div class="form-group mb-4">
                    <label class="block mb-1">Filiais Associadas:</label>
                    <div id="usuarioFiliaisCheckboxes" class="max-h-32 overflow-y-auto bg-gray-50 p-3 border rounded-md grid grid-cols-2 gap-2">
                        <div class="loading text-sm">Carregando filiais...</div>
                    </div>
                </div>

                <div id="usuarioAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Alterações no Perfil</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('usuarioModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    <div id="filialModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="text-xl font-semibold mb-4" id="filialModalTitle">Nova Filial</h3>
            <form id="filialForm">
                <input type="hidden" id="filialId">
                <div class="form-group mb-4">
                    <label for="filialNome">Nome (Ex: 464):</label>
                    <input type="text" id="filialNome" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="filialDescricao">Descrição (Ex: MT - Cuiabá):</label>
                    <input type="text" id="filialDescricao" required class="w-full">
                </div>
                
                <div id="filialAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Filial</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('filialModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="cgoModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <h3 class="text-xl font-semibold mb-4" id="cgoModalTitle">Novo CGO</h3>
            <form id="cgoForm">
                <input type="hidden" id="cgoId">
                <div class="form-group mb-4">
                    <label for="cgoCodigo">Código CGO (Ex: 475):</label>
                    <input type="text" id="cgoCodigo" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="cgoDescricao">Descrição (Ex: BAIXA QUEBRA DE ESTOQUE):</label>
                    <input type="text" id="cgoDescricao" required class="w-full">
                </div>
                
                <div class="form-group mb-4">
                    <label for="cgoTipoBaixaSelect">Tipo de Baixa (Grupo):</label>
                    <select id="cgoTipoBaixaSelect" class="w-full">
                        <option value="">Carregando...</option>
                    </select>
                </div>
                
                <div class="form-group mb-4">
                    <label for="cgoLinhaOrcamentaria">Linha Orçamentária (para débito):</label>
                    <select id="cgoLinhaOrcamentaria" class="w-full">
                        <option value="">Nenhuma (Não debita do orçamento)</option>
                        </select>
                </div>

                <div class="form-group mb-4">
                    <label for="cgoObs">Observação (Quando usar):</label>
                    <textarea id="cgoObs" rows="3" class="w-full"></textarea>
                </div>
                <div class="form-group flex items-center pt-2">
                    <input type="checkbox" id="cgoAtivo" class="h-5 w-5" checked>
                    <label for="cgoAtivo" class="ml-2 font-normal">CGO Ativo</label>
                </div>
                
                <div id="cgoAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar CGO</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('cgoModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="produtoModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <h3 class="text-xl font-semibold mb-4" id="produtoModalTitle">Novo Produto</h3>
            <form id="produtoForm">
                <input type="hidden" id="produtoIdAdmin">
                <div class="form-group mb-4">
                    <label for="produtoCodigoAdmin">Código do Produto:</label>
                    <input type="text" id="produtoCodigoAdmin" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="produtoDescricaoAdmin">Descrição:</label>
                    <input type="text" id="produtoDescricaoAdmin" required class="w-full">
                </div>
                
                <div class="form-group mb-4">
                    <label class="block mb-1">CGOs Permitidos:</label>
                    <div id="produtoCgosCheckboxes" class="max-h-40 overflow-y-auto bg-gray-50 p-3 border rounded-md grid grid-cols-2 gap-2">
                        <div class="loading text-sm">Carregando CGOs...</div>
                    </div>
                </div>

                <div id="produtoAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Produto</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('produtoModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="linhaModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="text-xl font-semibold mb-4" id="linhaModalTitle">Nova Linha Orçamentária</h3>
            <form id="linhaForm">
                <input type="hidden" id="linhaId">
                <div class="form-group mb-4">
                    <label for="linhaCodigo">Código (Ex: 06.08):</label>
                    <input type="text" id="linhaCodigo" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="linhaDescricao">Descrição (Ex: Festas e Eventos):</label>
                    <input type="text" id="linhaDescricao" required class="w-full">
                </div>
                <div class="form-group flex items-center pt-2">
                    <input type="checkbox" id="linhaAtivo" class="h-5 w-5" checked>
                    <label for="linhaAtivo" class="ml-2 font-normal">Linha Ativa</label>
                </div>
                
                <div id="linhaAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Linha</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('linhaModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="tipoBaixaModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="text-xl font-semibold mb-4" id="tipoBaixaModalTitle">Novo Tipo de Baixa</h3>
            <form id="tipoBaixaForm">
                <input type="hidden" id="tipoBaixaId">
                <div class="form-group mb-4">
                    <label for="tipoBaixaNome">Nome (Ex: QUEBRA, CONSUMO INTERNO):</label>
                    <input type="text" id="tipoBaixaNome" required class="w-full">
                </div>
                <div class="form-group mb-4">
                    <label for="tipoBaixaDescricao">Descrição (Opcional):</label>
                    <input type="text" id="tipoBaixaDescricao" class="w-full">
                </div>
                <div class="form-group flex items-center pt-2">
                    <input type="checkbox" id="tipoBaixaAtivo" class="h-5 w-5" checked>
                    <label for="tipoBaixaAtivo" class="ml-2 font-normal">Tipo Ativo</label>
                </div>
                <div id="tipoBaixaAlert" class="mt-4"></div>
                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">Salvar Tipo de Baixa</button>
                    <button type="button" class="btn btn-danger flex-1" onclick="closeModal('tipoBaixaModal')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>
               
<div id="detalhesDespesaModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 600px;">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-semibold">Detalhes da Despesa NF #<span id="detalhesDespesaNfNum"></span></h3>
                 <button class="btn btn-danger btn-small" onclick="closeModal('detalhesDespesaModal')">Fechar</button>
            </div>
            
            <div id="detalhesDespesaContent" class="space-y-3 text-sm">
                </div>
        </div>
    </div>
    
    <div id="consultaCgoModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 700px; max-height: 80vh; display: flex; flex-direction: column;">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-xl font-semibold text-gray-800">Consultar CGOs</h3>
                 <button class="btn btn-danger btn-small" onclick="closeModal('consultaCgoModal')">Fechar</button>
            </div>
            
            <div class="form-group mb-4">
                <input type="text" id="cgoSearchInput" placeholder="Filtrar por código, descrição ou observação..." class="w-full" style="padding: 12px 16px; font-size: 1rem;">
            </div>

            <div id="consultaCgoList" class="flex-1 overflow-y-auto space-y-3 bg-gray-50 p-3 rounded-md">
                <div class="loading"><div class="spinner"></div>Carregando CGOs...</div>
            </div>
        </div>
    </div>


    <button id="helpCgoButton" title="Consultar CGOs" style="display: none;">
        <i data-feather="help-circle" style="width: 28px; height: 28px;"></i>
    </button>
    
    <div id="notificationContainer"></div>
<div id="forgotPasswordModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 450px;">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Recuperar Senha</h3>
        <p class="text-sm text-gray-600 mb-4">Digite seu e-mail cadastrado. Se ele existir no sistema, você receberá um link para redefinir sua senha.</p>
        <form id="forgotPasswordForm">
            <div class="form-group mb-4">
                <label for="forgotEmail" class="font-semibold text-gray-700">E-mail:</label>
                <input type="email" id="forgotEmail" required class="w-full">
            </div>
            <div id="forgotPasswordAlert" class="mt-4"></div>
            <div class="flex gap-4 mt-6">
                <button type="submit" class="btn btn-primary flex-1">Enviar Link de Recuperação</button>
                <button type="button" class="btn btn-danger flex-1" onclick="closeModal('forgotPasswordModal')">Cancelar</button>
            </div>
        </form>
    </div>
</div>

<div id="requestAccessModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 500px;">
        <h3 class="text-xl font-semibold mb-4 text-gray-800">Solicitar Acesso</h3>
        <p class="text-sm text-gray-600 mb-4">Preencha seus dados. Sua solicitação será enviada ao administrador para aprovação.</p>
        <form id="requestAccessForm">
            <div class="form-group mb-3">
                <label for="requestNome" class="font-semibold text-gray-700">Nome Completo:</label>
                <input type="text" id="requestNome" required class="w-full">
            </div>
            <div class="form-group mb-3">
                <label for="requestEmail" class="font-semibold text-gray-700">Seu E-mail:</label>
                <input type="email" id="requestEmail" required class="w-full">
            </div>
            <div class="form-group mb-4">
                <label for="requestMotivo" class="font-semibold text-gray-700">Motivo/Justificativa:</label>
                <textarea id="requestMotivo" rows="3" required class="w-full"></textarea>
            </div>
            <div id="requestAccessAlert" class="mt-4"></div>
            <div class="flex gap-4 mt-6">
                <button type="submit" class="btn btn-primary flex-1">Enviar Solicitação</button>
                <button type="button" class="btn btn-danger flex-1" onclick="closeModal('requestAccessModal')">Cancelar</button>
            </div>
        </form>
    </div>
</div>
    <script>
        // Configuração Inicial - Use o Proxy
        const SUPABASE_PROXY_URL = '/api/proxy'; // Aponta para a sua serverless function
    </script>
    <script src="script.js"></script>
    <script>
        // Inicializar ícones e animações
        feather.replace();
        if (typeof AOS !== 'undefined') {
            AOS.init({ duration: 600, once: true });
        }
    </script>

</body>
</html>
